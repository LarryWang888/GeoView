"use strict";(self.webpackChunkgeoview_loader=self.webpackChunkgeoview_loader||[]).push([[138],{4498:(e,t,n)=>{var a=n(6307),r=n(5379),i=n(5964),l=n(8161),s=n(1889),o=n(1339),c=n(2537),u=n.n(c),d=n(5202),f=window;const p=function(e){var t=e.layersData,n=e.selectFeature,a=e.selectLayer,r=e.getSymbol,i=e.clickPos,l=e.mapId,s=f.cgpv,o=s.api,c=s.ui,u=o.eventNames,p=c.makeStyles((function(){return{layersContainer:{overflow:"hidden",overflowY:"auto",width:"100%"},layerItem:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"5px 0",padding:"10px 5px",boxSizing:"content-box","&:hover":{cursor:"pointer",backgroundColor:"#c9c9c9"},zIndex:1e3,border:"none",width:"100%"},layerParentText:{fontSize:"16px",fontWeight:"bold"},layerCountTextContainer:{display:"flex",alignItems:"center",width:"100%"},layerFeatureCount:{display:"flex",justifyContent:"center",alignItems:"center",width:"32px",minWidth:"32px",height:"32px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 20%), 0 1px 1px 0 rgb(0 0 0 / 14%), 0 2px 1px -1px rgb(0 0 0 / 12%)",marginRight:"10px",color:"black",fontSize:"16px",fontWeight:"bold"},layerItemText:{fontSize:"14px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}}}))(),y=function(e,t){var i=e.layers[t],l=i.layerData,s=i.displayField,o=i.fieldAliases,c=i.renderer;if(a(e.layers[t]),1===l.length){var u,d=null===(u=l[0])||void 0===u?void 0:u.attributes;n({attributes:d,displayField:s,fieldAliases:o,symbol:r(c,d),numOfEntries:1})}};return(0,d.jsx)("div",{className:p.layersContainer,children:Object.keys(t).map((function(e){var n=t[e];return(0,d.jsx)("div",{children:Object.keys(n.layers).map((function(e,t){var a=n.layers[e],s=a.layer,c=a.layerData,f=a.groupLayer;return(0,d.jsx)("div",{tabIndex:c.length>0&&!f?0:-1,onKeyDown:function(t){"Enter"===t.key&&(f||(t.preventDefault(),y(n,e)))},role:"button",children:f?(0,d.jsx)("div",{className:p.layerParentText,title:s.name,children:s.name}):(0,d.jsx)("button",{type:"button",tabIndex:-1,className:p.layerItem,disabled:0===c.length,onClick:c.length>0?function(){y(n,e),o.event.emit(u.EVENT_MARKER_ICON_SHOW,l,{latlng:i,symbology:r(n.layers[e].renderer,c[0].attributes)})}:void 0,children:(0,d.jsxs)("div",{className:p.layerCountTextContainer,children:[(0,d.jsx)("span",{className:p.layerFeatureCount,children:c.length}),(0,d.jsx)("div",{className:p.layerItemText,title:s.name,children:s.name})]})})},t)}))},n.id)}))})};var y=window;const m=function(e){var t=e.selectedLayer,n=e.selectLayer,a=e.selectFeature,r=e.setPanel,i=e.getSymbol,l=e.buttonPanel,s=y.cgpv,o=s.react,c=s.ui,u=s.useTranslation,f=o.useEffect,p=t,m=p.displayField,x=p.fieldAliases,b=p.layerData,g=p.renderer,h=c.makeStyles((function(){return{featuresContainer:{overflow:"hidden",overflowY:"auto",width:"100%"},featureItem:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"5px 0",padding:"10px 5px",boxSizing:"content-box","&:hover":{cursor:"pointer",backgroundColor:"#c9c9c9"},zIndex:1e3},featureIconTextContainer:{display:"flex",alignItems:"center",width:"100%"},featureItemIconContainer:{display:"flex",justifyContent:"center",alignItems:"center",width:"32px",minWidth:"32px",height:"32px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 20%), 0 1px 1px 0 rgb(0 0 0 / 14%), 0 2px 1px -1px rgb(0 0 0 / 12%)"},featureItemIcon:{},featureItemText:{display:"inline-block",width:"100%",fontWeight:400,marginLeft:"10px",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:"16px"}}}))(),v=u().t,I=function(e,t){var i;null===(i=l.panel)||void 0===i||i.addActionButton("back",v("action_back"),'<i class="material-icons">keyboard_backspace</i>',(function(){1===b.length?r(!0,!1,!1):n()})),a({attributes:e,displayField:m,fieldAliases:x,symbol:t,numOfEntries:b.length})};return f((function(){var e;null===(e=l.panel)||void 0===e||e.addActionButton("back",v("action_back"),'<i class="material-icons">keyboard_backspace</i>',(function(){r(!0,!1,!1)}))}),[]),b.length>0?(0,d.jsx)("div",{className:h.featuresContainer,children:b.map((function(e,t){var n=null==e?void 0:e.attributes,a=i(g,n),r=n[m],l=r.length>0?"".concat(r):"".concat(n.OBJECTID);return(0,d.jsx)("div",{tabIndex:0,onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),I(n,a))},role:"button",children:(0,d.jsx)("div",{className:h.featureItem,onClick:function(){I(n,a)},role:"button",children:(0,d.jsxs)("div",{className:h.featureIconTextContainer,children:[(0,d.jsx)("div",{className:h.featureItemIconContainer,children:a.imageData?(0,d.jsx)("img",{className:h.featureItemIcon,src:"data:".concat(a.contentType,";base64, ").concat(a.imageData),alt:""}):g.symbol.legendImageUrl?(0,d.jsx)("img",{className:h.featureItemIcon,src:g.symbol.legendImageUrl,alt:""}):(0,d.jsx)("div",{className:h.featureItemIcon})}),(0,d.jsx)("span",{className:h.featureItemText,title:l,children:l})]})})},t)}))}):(0,d.jsx)("div",{className:h.featureItemText,children:v("nothing_found")})};var x=window;const b=function(e){var t=e.buttonPanel,n=e.selectedFeature,a=e.setPanel,r=x.cgpv,i=r.react,l=r.ui,s=r.useTranslation,o=i.useEffect,c=n.displayField,u=n.fieldAliases,f=n.attributes,p=n.symbol,y=n.numOfEntries,m=l.makeStyles((function(){return{featureInfoContainer:{width:"100%"},featureInfoHeader:{display:"flex",alignItems:"center"},featureInfoHeaderIconContainer:{display:"flex",justifyContent:"center",alignItems:"center",width:"32px",minWidth:"32px",height:"32px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 20%), 0 1px 1px 0 rgb(0 0 0 / 14%), 0 2px 1px -1px rgb(0 0 0 / 12%)"},featureInfoHeaderIcon:{},featureInfoHeaderText:{marginLeft:"10px",width:"100%",fontSize:18},featureInfoItemsContainer:{display:"flex",flexDirection:"column",marginTop:20},featureInfoItem:{display:"flex",flexDirection:"column",margin:"5px 0"},featureInfoItemKey:{fontWeight:"bold",fontSize:16},featureInfoItemValue:{fontSize:16,backgroundColor:"#ddd"}}}))(),b=s().t;return o((function(){var e;null===(e=t.panel)||void 0===e||e.addActionButton("back",b("action_back"),'<i class="material-icons">keyboard_backspace</i>',(function(){1===y?a(!0,!1,!1):a(!1,!0,!1)}))}),[]),(0,d.jsxs)("div",{className:m.featureInfoContainer,children:[(0,d.jsxs)("div",{className:m.featureInfoHeader,children:[(0,d.jsx)("div",{className:m.featureInfoHeaderIconContainer,children:p.imageData?(0,d.jsx)("img",{className:m.featureInfoHeaderIcon,src:"data:".concat(p.contentType,";base64, ").concat(p.imageData),alt:""}):p.legendImageUrl?(0,d.jsx)("img",{className:m.featureInfoHeaderIcon,src:p.legendImageUrl,alt:""}):(0,d.jsx)("div",{className:m.featureInfoHeaderIcon})}),(0,d.jsx)("span",{className:m.featureInfoHeaderText,children:f[c].length>0?"".concat(f[c]):"".concat(f.OBJECTID)})]}),(0,d.jsx)("div",{className:m.featureInfoItemsContainer,children:Object.keys(f).map((function(e){var t=u[e],n=f[e];return n.length>0&&"OBJECTID"!==t&&"SHAPE"!==t&&"SHAPE_Length"!==t&&"SHAPE_Area"!==t&&(0,d.jsxs)("div",{className:m.featureInfoItem,tabIndex:0,children:[(0,d.jsx)("span",{className:m.featureInfoItemKey,children:t}),(0,d.jsx)("span",{className:m.featureInfoItemValue,children:n})]},e)}))})]})};var g=n(9975);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=window;const k=function(e){var t=e.buttonPanel,n=e.mapId,a=I.cgpv,r=a.api,c=a.react,f=a.ui,y=r.eventNames,x=c.useState,h=c.useCallback,k=c.useEffect,w=x({}),j=(0,o.Z)(w,2),N=j[0],E=j[1],P=x({}),C=(0,o.Z)(P,2),S=C[0],O=C[1],_=x({}),D=(0,o.Z)(_,2),T=D[0],A=D[1],L=x(!1),F=(0,o.Z)(L,2),Z=F[0],H=F[1],R=x(!1),B=(0,o.Z)(R,2),W=B[0],z=B[1],V=x(!1),K=(0,o.Z)(V,2),q=K[0],G=K[1],M=x(),U=(0,o.Z)(M,2),J=U[0],Y=U[1],Q=f.makeStyles((function(){return{mainContainer:{display:"flex",flexDirection:"row"}}}))(),X=r.map(n).map,$=h((function(e,t){var n=null;return e&&e.symbol?n=e.symbol:e&&e.uniqueValueInfos&&e.uniqueValueInfos.length>0&&(n=e.uniqueValueInfos.filter((function(n){return n.value===(t[e.field1]||t[e.field2]||t[e.field3])}))[0].symbol),n}),[]),ee=function(){var e=(0,s.Z)(u().mark((function e(t){var n,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(t,"?f=json"));case 2:return n=e.sent,e.next=5,n.json();case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=h((function(e,a,i){var l;null===(l=t.panel)||void 0===l||l.removeActionButton("back"),H(e),z(a),G(i),r.event.emit(y.EVENT_PANEL_CHANGE_CONTENT,n,{})}),[t.panel,n]),ne=h((function(){te(!0,!1,!1)}),[te]),ae=h((function(e){O(e||{}),te(!1,!0,!1)}),[O,te]),re=h((function(e){A(e),te(!1,!1,!0)}),[A,te]),ie=function(e,t,n,a){var r,i,l=t[e.id].layers;l["".concat(n.id,"-").concat(n.name.replace(/\s+/g,"-").toLowerCase())]={layer:n,groupLayer:a,layerData:[],displayField:n.displayField||n.displayFieldName||"",fieldAliases:(r=n.fields,i={},r&&r.forEach((function(e){var t=e.name,n=e.alias;i[t]=n})),i),renderer:n.drawingInfo&&n.drawingInfo.renderer},t[e.id].layers=l},le=h((function(e,t){var n=N[e].layers;n[t].layerData=[],E((function(t){return v(v({},t),{},(0,i.Z)({},e,v(v({},t[e]),{},{layers:n})))}))}),[N]),se=h(function(){var e=(0,s.Z)(u().mark((function e(a){var s,o,c,d,f,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=[],c=u().mark((function e(t){var n,r,s,c,d,f,p,y,m,x,b,h,I,k;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object.keys(N)[t],r=N[n],s=r.layer,c=r.layers,d=0;case 4:if(!(d<Object.keys(c).length)){e.next=23;break}if(f=Object.keys(c)[d],c[f].groupLayer){e.next=20;break}return le(n,f),p=(0,g.RF)(s)._map,y=p.getSize(),m=p.getBounds(),x={xmin:m.getSouthWest().lng,ymin:m.getSouthWest().lat,xmax:m.getNorthEast().lng,ymax:m.getNorthEast().lat,spatialReference:{wkid:4326}},b="".concat(s.mapService.options.url,"identify?")+"f=json&tolerance=3"+"&mapExtent=".concat(x.xmin,",").concat(x.ymin,",").concat(x.xmax,",").concat(x.ymax)+"&imageDisplay=".concat(y.x,",").concat(y.y,",96")+"&layers=visible:".concat(c[f].layer.id)+"&returnFieldName=true&sr=4326&returnGeometry=true"+"&geometryType=esriGeometryPoint&geometry=".concat(a.lng,",").concat(a.lat),e.next=15,fetch(b);case 15:return h=e.sent,e.next=18,h.json();case 18:(I=e.sent)&&I.results&&I.results.length>0&&(o.push({layer:c[f],entries:I.results}),null===(k=c[f].layerData)||void 0===k||k.push.apply(k,(0,l.Z)(I.results)),E((function(e){return v(v({},e),{},(0,i.Z)({},n,v(v({},e[n]),{},{layers:c})))})));case 20:d++,e.next=4;break;case 23:case"end":return e.stop()}}),e)})),d=0;case 3:if(!(d<Object.keys(N).length)){e.next=8;break}return e.delegateYield(c(d),"t0",5);case 5:d++,e.next=3;break;case 8:f=null,1===o.length?(ae(o[0].layer),o[0]&&(f=$(o[0].layer.renderer,o[0].entries[0].attributes)),1===o[0].entries.length&&re({attributes:o[0].entries[0].attributes,displayField:o[0].layer.displayField,fieldAliases:o[0].layer.fieldAliases,symbol:$(o[0].layer.renderer,o[0].entries[0].attributes),numOfEntries:1})):(o.length>0&&(f=$(o[0].layer.renderer,o[0].entries[0].attributes)),ne()),r.event.emit(y.EVENT_MARKER_ICON_SHOW,n,{latlng:a,symbology:f}),Y(a),null===(s=t.panel)||void 0===s||s.open(),(p=document.querySelectorAll("[data-id=".concat(t.id,"]"))[0])&&p.querySelectorAll(".cgpv-panel-close")[0].focus();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,t.panel,t.id,N,le,ae,$,re,ne]);return k((function(){var e=r.map(n).layer.layers,t={};e.forEach(function(){var e=(0,s.Z)(u().mark((function e(n){var a,r,i,l,o,c,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t[n.id]={id:n.id,type:n.type,layer:n.layer,layers:{}},"ogcWMS"!==n.type){e.next=17;break}a=n.layer.entries,r=0;case 4:if(!(r<a.length)){e.next=15;break}return i=a[r],e.next=8,ee(n.layer.mapService.options.url+i);case 8:l=e.sent,o="".concat(n.layer._url,"?request=GetLegendGraphic&version=1.0.0&Service=WMS&format=image/png&layer=").concat(i),l.drawingInfo&&l.drawingInfo.renderer&&l.drawingInfo.renderer.symbol&&Object.defineProperties(l.drawingInfo.renderer.symbol,{legendImageUrl:{value:o}}),ie(n,t,l,!1);case 12:r++,e.next=4;break;case 15:e.next=25;break;case 17:if("esriFeature"!==n.type){e.next=24;break}return e.next=20,ee(n.layer.options.url);case 20:c=e.sent,ie(n,t,c,!1),e.next=25;break;case 24:"esriDynamic"===n.type&&(d=n.layer.getLayers(),f={},d.forEach((function(e){f[e]=e})),n.layer.metadata(function(){var e=(0,s.Z)(u().mark((function e(a,r){var i,l,s,o,c,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=2;break}return e.abrupt("return");case 2:if(!r.layers){e.next=25;break}i=0;case 4:if(!(i<r.layers.length)){e.next=25;break}if(!((l=r.layers[i]).id in f)){e.next=22;break}return e.next=9,ee(n.layer.options.url+l.id);case 9:if(s=e.sent,ie(n,t,s,null!==l.subLayerIds&&void 0!==l.subLayerIds),!l.subLayerIds){e.next=22;break}o=0;case 13:if(!(o<l.subLayerIds.length)){e.next=22;break}return c=l.subLayerIds[o],e.next=17,ee(n.layer.options.url+c);case 17:d=e.sent,ie(n,t,d,!1);case 19:o++,e.next=13;break;case 22:i++,e.next=4;break;case 25:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),E(t)}),[]),k((function(){return X.on("click",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.originalEvent.shiftKey||se(t.latlng);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r.event.on(y.EVENT_DETAILS_PANEL_CROSSHAIR_ENTER,(function(e){e.handlerName===n&&se(e.latlng)}),n),function(){X.off("click"),r.event.off(y.EVENT_DETAILS_PANEL_CROSSHAIR_ENTER,n)}}),[se,n,X]),(0,d.jsxs)("div",{className:Q.mainContainer,children:[Z&&(0,d.jsx)(p,{clickPos:J,layersData:N,selectFeature:re,selectLayer:ae,getSymbol:$,mapId:n}),W&&(0,d.jsx)(m,{getSymbol:$,buttonPanel:t,selectLayer:ae,selectedLayer:S,selectFeature:re,setPanel:te}),q&&(0,d.jsx)(b,{buttonPanel:t,selectedFeature:T,setPanel:te})]})};var w=window,j=function(){function e(t,n){var r=this;(0,a.Z)(this,e),(0,i.Z)(this,"translations",{"en-CA":{detailsPanel:"Details",nothing_found:"Nothing found",action_back:"Back"},"fr-CA":{detailsPanel:"Détails",nothing_found:"Aucun résultat",action_back:"Retour"}}),(0,i.Z)(this,"added",(function(){var e,t,n=r.DetailsPluginProps.mapId,a=w.cgpv,i=a.api,l=(a.eventNames,i.map(n).language),s={id:"detailsPanelButton",tooltip:r.translations[l].detailsPanel,tooltipPlacement:"right",icon:'<i class="material-icons">details</i><div>Test</div>',visible:!1,type:"textWithIcon"},o={title:r.translations[l].detailsPanel,icon:'<i class="material-icons">details</i>',width:300};r.buttonPanel=i.map(n).appBarButtons.createAppbarPanel(s,o,null),null===(e=r.buttonPanel)||void 0===e||null===(t=e.panel)||void 0===t||t.changeContent((0,d.jsx)(k,{buttonPanel:r.buttonPanel,mapId:n}))})),this.id=t,this.DetailsPluginProps=n,this.buttonPanel=null}return(0,r.Z)(e,[{key:"removed",value:function(){var e=this.DetailsPluginProps.mapId,t=w.cgpv.api;this.buttonPanel&&(t.map(e).appBarButtons.removeAppbarPanel(this.buttonPanel.id),t.event.emit(t.eventNames.EVENT_MARKER_ICON_HIDE,e,{}))}}]),e}();w.plugins=w.plugins||{},w.plugins.detailsPanel=j}},e=>{var t;t=4498,e(e.s=t)}]);