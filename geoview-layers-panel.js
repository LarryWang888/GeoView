"use strict";(self.webpackChunkgeoview_loader=self.webpackChunkgeoview_loader||[]).push([[763],{6883:(e,t,n)=>{var r=n(6482),a=n(3915),i=n(3744),s=n(1565),c=n(8114),l=n(1871),o=n.n(l),u=n(5202),d=window,p=[["esriDynamic","ESRI Dynamic Service"],["esriFeature","ESRI Feature Service"],["geoJSON","GeoJSON"],["ogcWMS","OGC Web Map Service (WMS)"],["ogcWFS","OGC Web Feature Service (WFS)"],["xyzTiles","XYZ Raster Tiles"]],f=function(e){switch(e){case"esriDynamic":return{err:"ESRI Map",capability:"Map"};case"esriFeature":return{err:"ESRI Feature",capability:"Query"};default:return{err:"",capability:""}}};const v=function(e){var t=e.mapId,n=e.setAddLayerVisible,r=d.cgpv,a=r.api,i=r.react,l=r.ui,v=r.mui,y=i.useState,m=l.elements,x=m.Button,g=m.ButtonGroup,b=v.Stepper,h=v.Step,j=v.StepLabel,w=v.StepContent,S=v.TextField,k=v.Typography,O=v.InputLabel,C=v.FormControl,L=v.Select,P=v.MenuItem,I=y(0),N=(0,s.Z)(I,2),Z=N[0],T=N[1],E=y(""),D=(0,s.Z)(E,2),F=D[0],A=D[1],R=y(""),W=(0,s.Z)(R,2),M=W[0],B=W[1],G=y([]),U=(0,s.Z)(G,2),V=U[0],_=U[1],Y=y(""),z=(0,s.Z)(Y,2),J=z[0],q=z[1],X=y(""),H=(0,s.Z)(X,2),Q=H[0],K=H[1],$=l.makeStyles((function(){return{buttonGroup:{paddingTop:12,gap:6}}}))(),ee=function(e){a.event.emit("snackbar/open",t,{message:{type:"string",value:"".concat(e," cannot be empty")}})},te=function(e){a.event.emit("snackbar/open",t,{message:{type:"string",value:"URL is not a valid ".concat(e," Server")}})},ne=function(e,n){a.event.emit("snackbar/open",t,{message:{type:"string",value:"".concat(e," does not support current map projection ").concat(n)}})},re=function(){var e=(0,c.Z)(o().mark((function e(){var n,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.map(t).projection.getCRS().code,e.prev=1,e.next=4,a.geoUtilities.getWMSServiceMetadata(F,"");case 4:if(r=e.sent,r.Capability.Layer.CRS.includes(n)){e.next=8;break}throw"proj";case 8:1===(i=r.Capability.Layer.Layer.map((function(e){return[e.Name,e.Title]}))).length?(q(i[0][1]),K(i[0][0])):_(i),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),"proj"==e.t0?ne("WMS",n):te("WMS"),e.abrupt("return",!1);case 16:return e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=(0,c.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.geoUtilities.getWFSServiceMetadata(F);case 3:t=e.sent,1===(n=t.FeatureTypeList.FeatureType.map((function(e){return[e.Name["#text"].split(":")[1],e.Title["#text"]]}))).length?(q(n[0][1]),K(n[0][0])):_(n),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),te("WFS"),e.abrupt("return",!1);case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=(0,c.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.geoUtilities.getESRIServiceMetadata(F);case 3:if(!(n=e.sent).capabilities.includes(f(t).capability)){e.next=8;break}"layers"in n?1===(r=n.layers.map((function(e){var t=e.id,n=e.name;return[String(t),n]}))).length?(q(r[0][1]),K(r[0][0])):_(r):(q(n.name),K(String(n.id))),e.next=9;break;case 8:throw"err";case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),te(f(t).err),e.abrupt("return",!1);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),se=function(){for(var e=a.map(t).projection.getCRS().code,n=0,r=["{x}","{y}","{z}"];n<r.length;n++){var i=r[n];if(!F.includes(i))return te("XYZ Tile"),!1}return"EPSG:3857"===e||(ne("XYZ Tiles",e),!1)},ce=function(){var e=(0,c.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(F);case 3:return t=e.sent,e.next=6,t.json();case 6:if(n=e.sent,["FeatureCollection","Feature"].includes(n.type)){e.next=9;break}throw"err";case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),te("GeoJSON"),e.abrupt("return",!1);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=(0,c.Z)(o().mark((function e(){var r,i,s,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Z){e.next=3;break}if(""!==F.trim()){e.next=3;break}return e.abrupt("return",ee("URL"));case 3:if(1!==Z){e.next=39;break}if(r=!0,""!==M){e.next=7;break}return e.abrupt("return",ee("Service Type"));case 7:if("ogcWMS"!==M){e.next=11;break}return e.next=10,re();case 10:r=e.sent;case 11:if("ogcWFS"!==M){e.next=17;break}return e.next=14,ae();case 14:r=e.sent,e.next=37;break;case 17:if("xyzTiles"!==M){e.next=21;break}r=se(),e.next=37;break;case 21:if("esriDynamic"!==M){e.next=27;break}return e.next=24,ie("esriDynamic");case 24:r=e.sent,e.next=37;break;case 27:if("esriFeature"!==M){e.next=33;break}return e.next=30,ie("esriFeature");case 30:r=e.sent,e.next=37;break;case 33:if("geoJSON"!==M){e.next=37;break}return e.next=36,ce();case 36:r=e.sent;case 37:if(r){e.next=39;break}return e.abrupt("return");case 39:if(2!==Z){e.next=51;break}if(i=J,s=F,c=Q,"esriDynamic"===M?s=a.geoUtilities.getMapServerUrl(F):"esriFeature"===M&&(s=a.geoUtilities.getMapServerUrl(F)+"/"+Q,c=""),""!==J){e.next=46;break}return e.abrupt("return",ee("Layer"));case 46:l={name:i,type:M,url:s,entries:c},a.map(t).layer.addLayer(l),n(!1),ue({target:{value:""}}),T(-1);case 51:T((function(e){return e+1}));case 52:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){T((function(e){return e-1}))},ue=function(e){A(e.target.value),B(""),_([]),q(""),K("")},de=function(e){var t=e.isFirst,n=void 0!==t&&t,r=e.isLast,a=void 0!==r&&r;return(0,u.jsx)(g,{className:$.buttonGroup,children:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(x,{variant:"contained",type:"text",onClick:le,children:a?"Finish":"Continue"}),!n&&(0,u.jsx)(x,{variant:"contained",type:"text",onClick:oe,children:"Back"})]})})};return(0,u.jsxs)(b,{activeStep:Z,orientation:"vertical",children:[(0,u.jsxs)(h,{children:[(0,u.jsx)(j,{children:"Enter URL"}),(0,u.jsxs)(w,{children:[(0,u.jsx)(S,{label:"URL",variant:"standard",value:F,onChange:ue}),(0,u.jsx)("br",{}),(0,u.jsx)(de,{isFirst:!0})]})]}),(0,u.jsxs)(h,{children:[(0,u.jsx)(j,{children:"Select format"}),(0,u.jsxs)(w,{children:[(0,u.jsxs)(C,{fullWidth:!0,children:[(0,u.jsx)(O,{id:"service-type-label",children:"Service Type"}),(0,u.jsx)(L,{labelId:"service-type-label",value:M,onChange:function(e){B(e.target.value),_([]),q(""),K("")},label:"Service Type",children:p.map((function(e){var t=(0,s.Z)(e,2),n=t[0],r=t[1];return(0,u.jsx)(P,{value:n,children:r},n)}))})]}),(0,u.jsx)(de,{})]})]}),(0,u.jsxs)(h,{children:[(0,u.jsx)(j,{children:"Configure layer"}),(0,u.jsxs)(w,{children:[0===V.length&&""===Q&&(0,u.jsx)(S,{label:"Name",variant:"standard",value:J,onChange:function(e){q(e.target.value)}}),0===V.length&&""!==Q&&(0,u.jsx)(k,{children:J}),V.length>1&&(0,u.jsxs)(C,{fullWidth:!0,children:[(0,u.jsx)(O,{id:"service-layer-label",children:"Select Layer"}),(0,u.jsx)(L,{labelId:"service-layer-label",value:Q,onChange:function(e){K(e.target.value);var t=V.find((function(t){return t[0]===e.target.value}))[1];q(t)},label:"Select Layer",children:V.map((function(e){var t=(0,s.Z)(e,2),n=t[0],r=t[1];return(0,u.jsx)(P,{value:n,children:r},n+r)}))})]}),(0,u.jsx)("br",{}),(0,u.jsx)(de,{isLast:!0})]})]})]})};function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=window;const g=function(e){var t=e.mapId,n=e.layers,r=e.language,a=x.cgpv,l=a.mui,d=a.ui,p=a.react,f=a.api,v=p.useState,y=p.useEffect,g=v(""),b=(0,s.Z)(g,2),h=b[0],j=b[1],w=v({}),S=(0,s.Z)(w,2),k=S[0],O=S[1],C=v({}),L=(0,s.Z)(C,2),P=L[0],I=L[1],N=v({}),Z=(0,s.Z)(N,2),T=Z[0],E=Z[1],D=l.Slider,F=l.Tooltip,A=l.Checkbox,R=d.elements.Button,W={"en-CA":{removeLayer:"Remove Layer",opacity:"Adjust Opacity",visibility:"Toggle Visibility"},"fr-CA":{removeLayer:"Supprimer la Couche",opacity:"Ajuster l'opacité",visibility:"Basculer la Visibilité"}},M=d.makeStyles((function(){return{layersContainer:{overflow:"hidden",overflowY:"auto",width:"100%"},layerItem:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"5px 0",padding:"10px 5px",boxSizing:"content-box","&:hover":{cursor:"pointer",backgroundColor:"#c9c9c9"},zIndex:1e3,border:"none",width:"100%"},layerParentText:{fontSize:"16px",fontWeight:"bold"},layerCountTextContainer:{display:"flex",alignItems:"center",width:"100%",height:"32px"},layerItemText:{fontSize:"14px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",marginLeft:"10px",display:"flex",alignItems:"center",gap:6},layerItemGroup:{paddingBottom:12},flexGroup:{display:"flex",justifyContent:"flex-end",alignItems:"baseline"},slider:{width:"100%",paddingLeft:20,paddingRight:20},removeLayerButton:{height:38,minHeight:38,width:25,minWidth:25,"& > div":{textAlign:"center"}}}})),B=function(){var e=(0,c.Z)(o().mark((function e(){var t,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o().mark((function e(){var t,n,s,c,l,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=a[r]).getLegendGraphic){e.next=10;break}return e.next=4,t.getLegendGraphic();case 4:n=e.sent,s=t.url.includes("/MapServer")?t.name:"",c=[{name:s,dataUrl:n}],O((function(e){return m(m({},e),{},(0,i.Z)({},t.id,c))})),e.next=16;break;case 10:if(!t.getLegendJson){e.next=16;break}return e.next=13,t.getLegendJson();case 13:l=e.sent,u=Array.isArray(l)?l:[l],O((function(e){return m(m({},e),{},(0,i.Z)({},t.id,u))}));case 16:case"end":return e.stop()}}),e)})),r=0,a=Object.values(n);case 2:if(!(r<a.length)){e.next=7;break}return e.delegateYield(t(),"t0",4);case 4:r++,e.next=2;break;case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();y((function(){var e=Object.values(n).reduce((function(e,t){return m(m({},e),{},(0,i.Z)({},t.id,[]))}),{});O((function(t){return m(m({},e),t)})),B();var t=Object.values(n).reduce((function(e,t){return m(m({},e),{},(0,i.Z)({},t.id,100))}),{});I((function(e){return m(m({},t),e)}));var r=Object.values(n).reduce((function(e,t){return m(m({},e),{},(0,i.Z)({},t.id,!0))}),{});E((function(e){return m(m({},r),e)}))}),[n]);var G=M();return(0,u.jsx)("div",{className:G.layersContainer,children:Object.values(n).map((function(e){return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",className:G.layerItem,onClick:function(){return t=e.id,void j(t!==h?t:"");var t},children:(0,u.jsx)("div",{className:G.layerCountTextContainer,children:(0,u.jsx)("div",{className:G.layerItemText,title:e.name,children:e.name})})}),h===e.id&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:G.flexGroup,children:(0,u.jsx)(R,{className:G.removeLayerButton,tooltip:W[r].removeLayer,tooltipPlacement:"right",variant:"contained",type:"icon",icon:'<i class="material-icons">remove</i>',onClick:function(){return function(e){return f.map(t).layer.removeLayer(e)}(e)}})}),(0,u.jsxs)("div",{className:G.flexGroup,children:[(0,u.jsx)(F,{title:W[r].opacity,children:(0,u.jsx)("i",{className:"material-icons",children:"contrast"})}),(0,u.jsx)("div",{className:G.slider,children:(0,u.jsx)(D,{size:"small",value:P[e.id],valueLabelDisplay:"auto",onChange:function(t){return function(e,t){I((function(n){return m(m({},n),{},(0,i.Z)({},t.id,e))}));var n=T[t.id]?e/100:0;t.setOpacity(n)}(t.target.value,e)}})}),(0,u.jsx)(F,{title:W[r].visibility,children:(0,u.jsx)(A,{checked:T[e.id],onChange:function(t){return function(e,t){E((function(n){return m(m({},n),{},(0,i.Z)({},t.id,e))}));var n=e?P[t.id]/100:0;t.setOpacity(n)}(t.target.checked,e)}})})]}),k[e.id].map((function(e,t){var n,r,a,i,s,c,l,o;return(0,u.jsxs)("div",{className:G.layerItemGroup,children:[e.legend&&Object.values(e.legend).length>1&&(0,u.jsx)("div",{className:G.layerItemText,title:e.layerName,children:e.layerName}),"simple"===(null===(n=e.drawingInfo)||void 0===n?void 0:n.renderer.type)&&(null===(r=e.drawingInfo)||void 0===r?void 0:r.renderer.symbol.imageData)&&(0,u.jsxs)("div",{className:G.layerItemText,children:[(0,u.jsx)("img",{src:"data:".concat(null===(a=e.drawingInfo)||void 0===a?void 0:a.renderer.symbol.contentType,";base64,").concat(null===(i=e.drawingInfo)||void 0===i?void 0:i.renderer.symbol.imageData)}),(null===(s=e.drawingInfo)||void 0===s?void 0:s.renderer.label)||e.name]}),"uniqueValue"===(null===(c=e.drawingInfo)||void 0===c?void 0:c.renderer.type)&&(null===(l=e.drawingInfo)||void 0===l?void 0:l.renderer.uniqueValueInfos[0].symbol.imageData)&&(null===(o=e.drawingInfo)||void 0===o?void 0:o.renderer.uniqueValueInfos.map((function(e,t){return(0,u.jsxs)("div",{className:G.layerItemText,children:[(0,u.jsx)("img",{src:"data:".concat(e.symbol.contentType,";base64,").concat(e.symbol.imageData)}),e.label]},t)}))),e.legend&&e.legend.map((function(t,n){return(0,u.jsxs)("div",{className:G.layerItemText,children:[(0,u.jsx)("img",{src:"data:".concat(t.contentType,";base64,").concat(t.imageData)}),t.label||e.layerName]},n)})),e.dataUrl&&(0,u.jsxs)("div",{className:G.layerItemText,children:[(0,u.jsx)("img",{src:e.dataUrl}),e.name]})]},t)}))]})]},e.id)}))})};function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j=window;const w=function(e){var t=e.mapId,n=j.cgpv,r=n.api,a=n.react,i=n.ui,c=a.useState,l=a.useEffect,o=c(!1),d=(0,s.Z)(o,2),p=d[0],f=d[1],y=c({}),m=(0,s.Z)(y,2),x=m[0],b=m[1],w=i.elements.Button,S=r.map(t).language,k=i.makeStyles((function(){return{mainContainer:{display:"flex",flexDirection:"row"},addLayerButton:{width:50,minWidth:50,"& > div":{textAlign:"center"}}}}))();return l((function(){return b((function(){return h({},r.map(t).layer.layers)})),r.event.on(r.eventNames.EVENT_LAYER_ADDED,(function(){return b((function(){return h({},r.map(t).layer.layers)}))}),t),r.event.on(r.eventNames.EVENT_REMOVE_LAYER,(function(){return b((function(){return h({},r.map(t).layer.layers)}))}),t),function(){r.event.off(r.eventNames.EVENT_LAYER_ADDED,t),r.event.off(r.eventNames.EVENT_REMOVE_LAYER,t)}}),[]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:k.mainContainer,children:(0,u.jsx)(w,{className:k.addLayerButton,tooltip:{"en-CA":{addLayer:"Add Layer"},"fr-CA":{addLayer:"Ajouter Couche"}}[S].addLayer,tooltipPlacement:"right",variant:"contained",type:"icon",icon:'<i class="material-icons">add</i>',onClick:function(){return f((function(e){return!e}))}})}),(0,u.jsx)("div",{style:{display:p?"inherit":"none"},children:(0,u.jsx)(v,{mapId:t,setAddLayerVisible:f})}),(0,u.jsx)("div",{style:{display:p?"none":"inherit"},children:(0,u.jsx)(g,{mapId:t,layers:x,language:S})})]})};var S=window,k=function(){function e(t,n){var a=this;(0,r.Z)(this,e),(0,i.Z)(this,"translations",{"en-CA":{layersPanel:"Layers"},"fr-CA":{layersPanel:"Couches"}}),(0,i.Z)(this,"added",(function(){var e,t,n=a.LayersPanelPluginProps.mapId,r=S.cgpv.api,i=r.map(n).language,s={id:"layersPanelButton",tooltip:a.translations[i].layersPanel,tooltipPlacement:"right",icon:'<i class="material-icons">layers</i>',type:"textWithIcon"},c={title:a.translations[i].layersPanel,icon:'<i class="material-icons">layers</i>',width:200};a.buttonPanel=r.map(n).appBarButtons.createAppbarPanel(s,c,null),null===(e=a.buttonPanel)||void 0===e||null===(t=e.panel)||void 0===t||t.changeContent((0,u.jsx)(w,{buttonPanel:a.buttonPanel,mapId:n}))})),this.id=t,this.LayersPanelPluginProps=n,this.buttonPanel=null}return(0,a.Z)(e,[{key:"removed",value:function(){var e=this.LayersPanelPluginProps.mapId,t=S.cgpv.api;this.buttonPanel&&t.map(e).appBarButtons.removeAppbarPanel(this.buttonPanel.id)}}]),e}();S.plugins=S.plugins||{},S.plugins.layersPanel=k}},e=>{var t;t=6883,e(e.s=t)}]);